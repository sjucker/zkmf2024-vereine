<div>
  <app-header header="ZKMF2024 - Vereinsbereich"></app-header>

  <div class="max-width-container" *ngIf="verein">
    <h2>
      Phase 1 (bis 15.09.2023)
      <mat-icon class="done" *ngIf="isPhaseDone(verein.phase1Status)">check_circle</mat-icon>
      <mat-icon *ngIf="!isPhaseDone(verein.phase1Status)">error_circle_rounded</mat-icon>
    </h2>
    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Vereinsangaben</mat-panel-title>
          <mat-panel-description>
            <app-validation-state [valid]="verein.angaben.valid"></app-validation-state>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div class="form-layout">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.email"
                   disabled="true">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Vereinsname</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.vereinsname">
          </mat-form-field>
        </div>

        <div class="form-layout">
          <mat-form-field appearance="outline">
            <mat-label>Adresse</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.adresse">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>PLZ</mat-label>
            <input type="number"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.plz">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Ort</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.ort">
          </mat-form-field>
        </div>
        <div class="form-layout">
          <mat-form-field appearance="outline">
            <mat-label>Homepage</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.homepage">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>PC/IBAN</mat-label>
            <input type="text"
                   autocomplete="off"
                   matInput
                   [(ngModel)]="verein.angaben.iban">
          </mat-form-field>
        </div>
        <app-action-button buttonLabel="Speichern"
                           [processing]="saving"
                           (buttonClicked)="save()"></app-action-button>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Anmeldung</mat-panel-title>
          <mat-panel-description>
            <app-validation-state [valid]="verein.anmeldung.valid"></app-validation-state>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div class="anmeldung-container">

          <div class="selection">
            <div><span class="mat-headline-6">Modul</span><br/>(mindestens ein Modul auswählen)</div>

            <mat-checkbox [(ngModel)]="verein.anmeldung.modulA">A - Konzertmusik</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulB">B - Unterhaltungsmusik</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulC">C - Platzkonzerte</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulD">D - Parademusik traditionell</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulE">E - Parademusik mit Evolutionen</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulF">F - Hallen-/Rasenshow</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulG">G - Tambouren</mat-checkbox>
            <mat-checkbox [(ngModel)]="verein.anmeldung.modulH">H - Perkussionsensembles</mat-checkbox>
          </div>
          <div class="selection">
            <div><span class="mat-headline-6">Stärkeklasse</span><br/>&nbsp;</div>
            <div
              *ngIf="!verein.anmeldung.modulA && !verein.anmeldung.modulB && !verein.anmeldung.modulH">
              Bitte ein entsprechendes Modul auswählen
            </div>
            <mat-form-field appearance="outline" *ngIf="verein.anmeldung.modulA">
              <mat-label>Stärkeklasse Modul A</mat-label>
              <mat-select [(ngModel)]="verein.anmeldung.klasseModulA" required>
                <mat-option [value]="HOECHSTKLASSE">Höchstklasse</mat-option>
                <mat-option [value]="KLASSE_1">1. Klasse</mat-option>
                <mat-option [value]="KLASSE_2">2. Klasse</mat-option>
                <mat-option [value]="KLASSE_3">3. Klasse</mat-option>
                <mat-option [value]="KLASSE_4">4. Klasse</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" *ngIf="verein.anmeldung.modulB">
              <mat-label>Stärkeklasse Modul B</mat-label>
              <mat-select [(ngModel)]="verein.anmeldung.klasseModulB" required>
                <mat-option [value]="OBERSTUFE">Oberstufe</mat-option>
                <mat-option [value]="MITTELSTUFE">Mittelstufe</mat-option>
                <mat-option [value]="UNTERSTUFE">Unterstufe</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="outline" *ngIf="verein.anmeldung.modulH">
              <mat-label>Stärkeklasse Modul H</mat-label>
              <mat-select [(ngModel)]="verein.anmeldung.klasseModulH" required>
                <mat-option [value]="OBERSTUFE">Oberstufe</mat-option>
                <mat-option [value]="MITTELSTUFE">Mittelstufe</mat-option>
                <mat-option [value]="UNTERSTUFE">Unterstufe</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="selection">
            <div><span class="mat-headline-6">Besetzung</span><br/>&nbsp;</div>
            <div *ngIf="noModulSelected">
              Bitte ein Modul auswählen
            </div>

            <mat-checkbox *ngIf="harmonieVisible"
                          [(ngModel)]="verein.anmeldung.harmonie"
                          [disabled]="verein.anmeldung.brassBand || verein.anmeldung.fanfare">Harmonie
            </mat-checkbox>
            <mat-checkbox *ngIf="brassBandVisible"
                          [(ngModel)]="verein.anmeldung.brassBand"
                          [disabled]="verein.anmeldung.harmonie || verein.anmeldung.fanfare">Brass Band
            </mat-checkbox>
            <mat-checkbox *ngIf="fanfareVisible"
                          [(ngModel)]="verein.anmeldung.fanfare"
                          [disabled]="verein.anmeldung.harmonie || verein.anmeldung.brassBand">Fanfare
            </mat-checkbox>
            <mat-checkbox *ngIf="tambourenVisible"
                          [(ngModel)]="verein.anmeldung.tambouren">Tambouren
            </mat-checkbox>
            <mat-checkbox *ngIf="perkussionsensembleVisible"
                          [(ngModel)]="verein.anmeldung.perkussionsensemble">Perkussionsensemble
            </mat-checkbox>
          </div>
        </div>

        <app-action-button buttonLabel="Speichern"
                           [processing]="saving"
                           (buttonClicked)="saveAnmeldung()"></app-action-button>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Kontaktangaben - Präsident/in</mat-panel-title>
          <mat-panel-description>
            <app-validation-state [valid]="verein.praesident.valid"></app-validation-state>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <app-kontakt-form [kontakt]="verein.praesident"></app-kontakt-form>

        <app-action-button buttonLabel="Speichern"
                           [processing]="saving"
                           (buttonClicked)="save()"></app-action-button>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Kontaktangaben - Direktion</mat-panel-title>
          <mat-panel-description>
            <app-validation-state [valid]="verein.direktion.valid"></app-validation-state>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <app-kontakt-form [kontakt]="verein.direktion"></app-kontakt-form>

        <app-action-button buttonLabel="Speichern"
                           [processing]="saving"
                           (buttonClicked)="save()"></app-action-button>
      </mat-expansion-panel>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Vereinsinfo (Website)</mat-panel-title>
          <mat-panel-description>
            <app-validation-state [valid]="verein.info.valid"></app-validation-state>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <mat-form-field appearance="outline" color="primary">
          <mat-label>Vorstellungstext</mat-label>
          <textarea matInput
                    cdkTextareaAutosize
                    cdkAutosizeMinRows="4"
                    cdkAutosizeMaxRows="10"
                    maxlength="4096"
                    [(ngModel)]="verein.info.websiteText"></textarea>
        </mat-form-field>
        <app-action-button buttonLabel="Speichern"
                           [processing]="saving"
                           (buttonClicked)="save()"></app-action-button>
        <div class="upload-container">
          <ngx-dropzone (change)="onDrop($event, true)"
                        [multiple]="false"
                        accept="image/jpeg,image/jpg"
                        [maxFileSize]="maxFileSize"
                        *ngIf="!verein.info.logoImgId">
            <ngx-dropzone-label>Vereinslogo (max. 1 MB)<br/>(Drag-and-Drop oder hier klicken)</ngx-dropzone-label>
            <ngx-dropzone-preview [removable]="true" (removed)="onRemove(true)" *ngIf="logo">
              <ngx-dropzone-label>{{ logo.name }} ({{ logo.type }})</ngx-dropzone-label>
            </ngx-dropzone-preview>
          </ngx-dropzone>

          <img [src]="logoImgSrc" *ngIf="verein.info.logoImgId" alt="Vereinslogo"/>

          <ngx-dropzone (change)="onDrop($event, false)"
                        [multiple]="false"
                        accept="image/jpeg,image/jpg"
                        [maxFileSize]="maxFileSize"
                        *ngIf="!verein.info.bildImgId">
            <ngx-dropzone-label>Vereinsbild (max. 1 MB)<br/>(Drag-and-Drop oder hier klicken)</ngx-dropzone-label>
            <ngx-dropzone-preview [removable]="true" (removed)="onRemove(false)" *ngIf="bild">
              <ngx-dropzone-label>{{ bild.name }} ({{ bild.type }})</ngx-dropzone-label>
            </ngx-dropzone-preview>
          </ngx-dropzone>

          <img [src]="bildImgSrc" *ngIf="verein.info.bildImgId" alt="Vereinsbild"/>

        </div>
        <app-action-button buttonLabel="Upload"
                           [processing]="uploading"
                           [disabled]="!logo && !bild"
                           (buttonClicked)="upload()"></app-action-button>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <mat-card appearance="outlined" *ngIf="!verein && !notFound && !error">
    <mat-card-content>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </mat-card-content>
  </mat-card>

  <mat-card appearance="outlined" *ngIf="notFound">
    <mat-card-content>
      <p>Es wurde kein Verein für diesen Login gefunden.</p>
    </mat-card-content>
  </mat-card>

  <mat-card appearance="outlined" *ngIf="error">
    <mat-card-content>
      <p>Ein Fehler ist aufgetreten.</p>
    </mat-card-content>
  </mat-card>
</div>
